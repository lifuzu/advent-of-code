/*
  --- Day 19: A Series of Tubes ---
  Somehow, a network packet got lost and ended up here. It's trying to follow a routing diagram (your puzzle input), but it's confused about where to go.

  Its starting point is just off the top of the diagram. Lines (drawn with |, -, and +) show the path it needs to take, starting by going down onto the only line connected to the top of the diagram. It needs to follow this path until it reaches the end (located somewhere within the diagram) and stop there.

  Sometimes, the lines cross over each other; in these cases, it needs to continue going the same direction, and only turn left or right when there's no other option. In addition, someone has left letters on the line; these also don't change its direction, but it can use them to keep track of where it's been. For example:

       |
       |  +--+
       A  |  C
   F---|----E|--+
       |  |  |  D
       +B-+  +--+

  Given this diagram, the packet needs to take the following path:

  Starting at the only line touching the top of the diagram, it must go down, pass through A, and continue onward to the first +.
  Travel right, up, and right, passing through B in the process.
  Continue down (collecting C), right, and up (collecting D).
  Finally, go all the way left through E and stopping at F.
  Following the path to the end, the letters it sees on its path are ABCDEF.

  The little packet looks up at you, hoping you can help it find the way. What letters will it see (in the order it would see them) if it follows the path? (The routing diagram is very wide; make sure you view it without line wrapping.)

  Your puzzle answer was PBAZYFMHT.

  --- Part Two ---
  The packet is curious how many steps it needs to go.

  For example, using the same routing diagram from the example above...

       |
       |  +--+
       A  |  C
   F---|--|-E---+
       |  |  |  D
       +B-+  +--+

  ...the packet would go:

  6 steps down (including the first line at the top of the diagram).
  3 steps right.
  4 steps up.
  3 steps right.
  4 steps down.
  3 steps right.
  2 steps up.
  13 steps left (including the F it stops on).
  This would result in a total of 38 steps.

  How many steps does the packet need to go?

 */
const assert = require('assert')

const direction = { 'up': 0, 'right': 1, 'down': 2, 'left': 3 }
// y point to down, x point to right
const turn = { 'up': [0, -1], 'right': [1, 0], 'down': [0, 1], 'left': [-1, 0] }

class Tubes {
  constructor() {}
  walk(input) {
    // parse and place the tubes into a d2 array
    // go to the first line to find |
    // go down, until + or char (char_array)
    // when has +, detect 4 direction if there is one have  -, |, +, char
    // go forward along the direction, until no anything around
    const array = [], char_array = []

    const lines = input.split(/\n/)

    for (let line of lines) {
      array.push(line.split(''))
    }

    let ch = '|', step_num = 0
    let x = array[0].indexOf(ch), y = 0, d = direction.down
    while(ch) {
      let [n_ch, n_x, n_y, n_d] = this.step(array, ch, x, y, d)
      // console.log([n_ch, n_x, n_y, n_d])
      ch = n_ch; x = n_x; y = n_y; d = n_d
      step_num++
      // if nothing around, means it is end
      if (ch === ' ') break
      // if it is letter, push to `char_array`
      if (ch !== '|' && ch !== '-' && ch !== '+') {
        char_array.push(ch)
      }
    }
    return [char_array.toString().replace(/,/g, ''), step_num]
  }

  step(arr, ch, x, y, d) {
    switch(ch) {
      case '|':
        [x, y] = this.forward(x, y, d)
        break
      case '-':
        [x, y] = this.forward(x, y, d)
        break
      case '+':
        [x, y, d] = this.turn(arr, x, y, d)
        break
      default:
        [x, y] = this.forward(x, y, d)

    }
    return [arr[y][x], x, y, d]
  }
  forward(x, y, d) {
    switch(d) {
      case direction.right:
        x++; break
      case direction.left:
        x--; break
      case direction.down:
        y++; break
      case direction.up:
        y--; break
      default:
        console.error('ERROR direction', d)
    }
    return [x, y]
  }
  turn(arr, x, y, d) {
    let go = null
    switch(d) {
      case direction.right:
        go = this.right(arr, x, y, d)
        if (go) return go
        go = this.up(arr, x, y, d)
        if (go) return go
        go = this.down(arr, x, y, d)
        if (go) return go

      case direction.left:
        go = this.left(arr, x, y, d)
        if (go) return go
        go = this.up(arr, x, y, d)
        if (go) return go
        go = this.down(arr, x, y, d)
        if (go) return go

      case direction.down:
        go = this.right(arr, x, y, d)
        if (go) return go
        go = this.left(arr, x, y, d)
        if (go) return go
        go = this.down(arr, x, y, d)
        if (go) return go

      case direction.up:
        go = this.right(arr, x, y, d)
        if (go) return go
        go = this.up(arr, x, y, d)
        if (go) return go
        go = this.left(arr, x, y, d)
        if (go) return go

      default:
        console.error('ERROR direction', d)
    }
  }
  right(arr, x, y, d) {
    let [i, j] = [x + turn.right[0], y + turn.right[1]]
    if (arr[j] && arr[j][i] && arr[j][i] !== ' ') {
      x = i; y = j; d = direction.right
      return [x, y, d]
    }
    return null
  }
  up(arr, x, y, d) {
    let [i, j] = [x + turn.up[0], y + turn.up[1]]
    if (arr[j] && arr[j][i] && arr[j][i] !== ' ') {
      x = i; y = j; d = direction.up
      return [x, y, d]
    }
    return null
  }
  down(arr, x, y, d) {
    let [i, j] = [x + turn.down[0], y + turn.down[1]]
    if (arr[j] && arr[j][i] && arr[j][i] !== ' ') {
      x = i; y = j; d = direction.down
      return [x, y, d]
    }
    return null
  }
  left(arr, x, y, d) {
    let [i, j] = [x + turn.left[0], y + turn.left[1]]
    if (arr[j] && arr[j][i] && arr[j][i] !== ' ') {
      x = i; y = j; d = direction.left
      return [x, y, d]
    }
    return null
  }
}

module.exports = {
  Tubes
}

if (require.main === module) {
  const tube = new Tubes()

  let input = `     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+`
  let output = tube.walk(input)
  console.log(output)
  assert.equal(output[0], 'ABCDEF')
  assert.equal(output[1], 38)

  console.log('======')

  input = `                                                                                                                   |
                 +-------------------------+ +-+               +-------------+                                     |                                           +-+   +-----------------+       +-------+
                 |                         | | |               |             |                                     |                                           | |   |                 |       |       |
 +---------------|---------------------------------------------|-------------|-------------------------------------|-------+     +-----------------------------+ |   |       +-------------------+ +-+ |
 |               |                         | | |               |             |                                     |       |     |                               |   |       |         |       | | | | |
 +---------+     |               +-----------+ +---------------|-------------|---------------+           +---------|-------|-----------------------------------------|-----------------|-------+ +-+ | |
           |     |               |         |                   |             |               |           |         |       |     |                               |   |       |         |             | |
           | +-------------------|-----------------------------|-----+       |               |           |         |       |     |                               | +-----+   +---------|---------+   | |
           | |   |               |         |                   |     |       |               |           |         |       |     |                               | | |   |             |         |   | |
   +-------------|-------------------------|-------------------|-----|-------|---------------------------------------------------|---------------------------------|-|---|-------------|-------------|-+
   |       | |   |               |         |                   |     |       |               |           |         |       |     |                               | | |   |             |         |   |
   |       | |   +---------------|-----+   |                   |     |       |               |           |         |   +---|-----+             +-----------------------+ |             |         |   |
   |       | |                   |     |   |                   |     |       |               |           |         |   |   |                   |                 | | | | |             |         |   |
   |       +-+                   |     |   |           +-------|-----|-------|-------------------------------------|---|-----------------------|-----------------|---|-|-|---+         |         |   |
   |                             |     |   |           |       |     |       |               |           |         |   |   |                   |                 | | | | |   |         |         |   |
   |                         +-------------------------|-------|-----------------------------------------------------------|---------------------------------------+ +-+ |   |         |         |   |
   |                         |   |     |   |           |       |     |       |               |           |         |   |   |                   |                 |       |   |         |         |   |
   |                         |   |     |   |           |       |     |       |               |           |         |   |   |                   |                 |       |   |         |         |   |
   |                         |   |     |   |           |       |     |       |               |           |         |   |   |                   |                 |       |   |         |         |   |
   |                         |   |     +---|-----------|-----+ |     |       |               |           |         |   |   |           +-------|-----------------|-------|-----------+ |         |   |
   |                         |   |         |           |     | |     |       |               |           |         |   |   |           |       |                 |       |   |       | |         |   |
   |                         |   |         | +---------|-----|-------|---+   |               |           |         |   |   |           +---------------------------------------------|-|---------|---|-+
   |                         |   |         | |         |     | |     |   |   |               |           |         |   |   |                   |                 |       |   |       | |         |   | |
   |                         |   |         | |         |     | |     |   |   |               |           |         |   |   |               +-------------------+ |       |   |       | |         |   | |
   |                         |   |         | |         |     | |     |   |   |               |           |         |   |   |               |   |               | |       |   |       | |         |   | |
   |       +-----------------|---|-+       | |         +-----|-|-----|-------|---------------------------|---------|---------------------------|----F--------------------|-----+     | |         |   | |
   |       |                 |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |       |   | |     | |         |   | |
   |       |   +-+ +---------------|---------|---------------------------|---|---------------|-------------------------------------------------|-----------------|-----+ |   | |     | |         |   | |
   |       |   | | |         |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | |         |   | |
   |       |   | | |         |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | |         |   | |
   |       |   | | |         |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | |         |   | |
   |       |   | | |         |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | |         |   | |
   |       |   | | |         |   | |       | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | |         |   | |
   | +-+   +---|-|-----+     |   | +---+   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     +---------+ |   | |
   | | |       | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |       |       | |   | |
   | | |       | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |       |       | |   | |
   | | |       | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |       |       | |   | |
   | | +-------|-|-----------------+   |   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     +---+     | |   | |
   | |         | | |   |     |   | |   |   | |               | |     |   |   |               |           |         |   |   |               |   |               | |     | |   | |     | | |     | |   | |
   | |   +-------|-|---|---------|-|-----------------------------------------|---------------|-----------|---------|---|---|---------------|---|-+   +-----+   | |     | |   | |     | | |     | |   | |
   | |   |     | | |   |     |   | |   |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |     |   | |     | |   | |     | | |     | |   | |
   | |   |     | | |   |     |   | |   |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |     +-+ | |     | |   | |     | | |     | |   | |
   | |   |     | | |   |     |   | |   |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |       | | |     | P   | |     | | |     | |   | |
   | |   |     | | |   |     |   | +---|---|-|-------------------------------|---------------|-----------|-----------------|-------------------------|-----------------|-------|-------+ |     | |   | |
   | |   |     | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |       | | |     | |   | |     |   |     | |   | |
   | |   |     | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |   +-+ | | |     | |   | |     |   +-----|-|-+ | |
   | |   |     | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |   | | | | |     | |   | |     |         | | | | |
   | |   | +-----|-----------|---|---------|-|-----------------|---------|---|-------------------------------------|---|-----------------------|-|---|---|-----|---------------------|---+     | | | | |
   | |   | |   | | |   |     |   |     |   | |               | |     |   |   |               |           |         |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | | | | |
   | |   | |   | | |   |     |   |     +-----------------------|-----|-----------------------+ +---------+         |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | | | | |
   | |   | |   | | |   |     |   |         | |               | |     |   |   |                 |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | | | | |
   | |   | |   | | |   |     |   |         | |               | |     |   |   |                 |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | | | | |
   | |   | |   | | |   |     |   |         | |               | |     |   |   |                 |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | | | | |
   | |   | |   | | |   |     |   |         | |           +-----------+   |   +-----------------------------------------|-------------------|-----|---|---|-|-|---------|-----|-|-----|---|-----|---+ | |
   | |   | |   | | |   |     |   |         | |           |   | |         |                     |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | |   | |
   | |   | |   | | |   |     |   |         | |           |   | |         |                     |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | |   | |
   | |   | |   | | |   |     |   |         | |           |   | |         |                     |                   |   |   |               |   | |   |   | | | | |     | |   | |     |   |     | |   | |
   | |   | |   | | |   |     |   |   +-----+ |           |   | |         |                     +-------------------------------------------------|-----------|-|---------|-----|-----|---|-----+ |   | |
   | |   | |   | | |   |     |   |   |       |           |   | |         |                                         |   |   |               |   | |   |   | | | | |     | |   | |     |   |       |   | |
   | |   | |   | | |   |     |   |   |       |           |   | |         |                                         +---|-+ |               |   | |   |   | | | | |     | |   | |     |   |       |   | |
   | |   | |   | | |   |     |   |   |       |           |   | |         |                                             | | |               |   | |   |   | | | | |     | |   | |     |   |       |   | |
   | |   | |   | | |   |     |   |   |       |           |   | |         |                   +-----------------------------|---------------------+   |   | | | | |     | |   | |     | +-|-------|-+ | |
   | |   | |   | | |   |     |   |   |       |           |   | |         |                   |                         | | |               |   |     |   | | | | |     | |   | |     | | |       | | | |
   | |   | +-----|-|---------|---|-------+   |           |   | |         |                   |                         | | |               |   |     |   | | | | |     | |   | |     | | |       | | | |
   | |   |     | | |   |     |   |   |   |   |           |   | |         |                   |                         | | |               |   |     |   | | | | |     | |   | |     | | |       | | | |
   | |   |     | | |   |     |   | +---------|-----------|---|-----------|-------------------+                         | | |               |   |     |   | | | | |     | |   | |     | | |       | | | |
   | |   |     | | |   |     |   | | |   |   |           |   | |         |                                             | | |               |   |     |   | | | | |     | |   | |     | | |       | | | |
   | |   |     | | |   |     | +---|-|---|-------+       |   | |         |               +-------------------------------------------------|---------|-----|-|---|-----|-------+     | | |     +-----|-+
   | |   |     | | |   |     | | | | |   |   |   |       |   | |         |               |                             | | |               |   |     |   | | | | |     | |   |       | | |     | | | |
   | |   | +---|---|---------|-|-----|---|-------|-------|---|-|---------|---------------------------------------------|-|-----------------|---|---+ |   | | | | |     | |   |       | | |     | | | |
   | |   | |   | | |   |     | | | | |   |   |   |       |   | |         |               |                             | | |               |   |   | |   | | | | |     | |   |       | | |     | | | |
 +---|---|-----|---|-+ |     | | | +-|-------------------|-------------------------------|---------------+             | | |               |   +---|-|---|-|---|-|-------|---------+ | | |     | | | |
 | | |   | |   | | | | |     | | |   |   |   |   |       |   | |         |               |               |             | | |               |       | |   | | | | |     | |   |     | | | |     | | | |
 | | +-----|---|-|-|---|-----|---|---|-------|-----------|-----|---------|-------------------------------|-----------------------------------------|-|---+ | | | |     | |   |     | | | |     | | | |
 | |     | |   | | | | |     | | |   |   |   |   |       |   | |         |               |               |             | | |               |       | |     | | | |     | |   |     | | | |     | | | |
 | |     | |   | | | | |     | | |   |   |   |   |       |   | |         |               |               |             | | |               |       | |     | | | |     | |   |     | | | |     | | | |
 | |     | |   | | | | |     | | |   |   |   |   |       |   | |         |               |               |             | | |               |       | |     | | | |     | |   |     | | | |     | | | |
 | |   +---------|-|---|-----|---|-----------------------|---|-+         |               |               |             | | |               |       | |     | | | |     | |   |     | | | |     | | | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |               |               |             | | |               |       | |     | | | |     | |   |     | | | |     | | | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |               |               |         +-------------+         +---------|-----|-|---|-----+ |   |     | | | |     | | | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |               |               |         |   | | |     |                 | |     | | | |       |   |     | | | |     | | | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |   +-----+     |               |         |   | | |   +---------------------------|-+ | |       |   |     | | | |   +-|-+ | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |   |     |     |               |         |   | | |   | |                 | |     |   | |       |   |     | | | |   | |   | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |   |     |     | +-------------|-----------------|---|-|-----------------|-----------|-|-----+ |   |     | | | |   | |   | |
 | |   | | |   | | | | |     | | |   |   |   |   |       |   |           |   |     |     | |             |         |   | | |   | |                 | |     |   | |     | |   |     | | | |   | |   | |
 | |   | +-|---|-|-----|-----|---|---|---|---|-------------------------------------|-----|-|-----------------------|-----|-|-----|-------------+ +-+ |   +-|---|-+     | |   |     | | | |   | |   | |
 | |   |   |   | | | | |     | | |   |   |   |   |       |   |           |   |     |     | |             |         |   | | |   | |             | |   |   | |   |       | |   |     | | | |   | |   | |
 | |   +---+   | | | | |     | | |   |   |   |   |       |   |           |   |     |     | |             |         |   | | |   | |           +---|-T |   | |   |       | |   |     | | | |   | |   | |
 | |           | | | | |     | | |   |   |   |   |       |   |           |   |     |     | |             |         |   | | |   | |           | | |   |   | |   |       | |   |     | | | |   | |   | |
 | |           | | | | |     | | |   +---|-------|-+     |   | +---------|-------------------------------|-------------|-|-----|-|-----+     | | | +-----------|-------+ |   |     | | | |   | | +-|---+
 | |           | | | | |     | | |       |   |   | |     |   | |         |   |     |     | |             |         |   | | |   | |     |     | | | | |   | |   |         |   |     | | | |   | | | | | |
 | |   +-+     | | | | |     | | |       |   |   | |     |   | |         |   |     +-------|-----------------------|-----|-------|-----|-----|-|-|-|-|---|-----|---------------------|---|-+ | | | | | |
 | |   | |     | | | | |     | | |       |   |   | |     |   | |         |   |           | |             |         |   | | |   | |     |     | | | | |   | |   |         |   |     | | | | | | | | | | |
 | |   | |     | | | | |     | | |       |   |   | |     |   | |         |   |           | |             |         |   | | |   | |     |     | | | | | +-|-----|-------------|-----|---|-|-+ | | | | | |
 | |   | |     | | | | |     | | |       |   |   | |     |   | |         |   |           | |             |         |   | | |   | |     |     | | | | | | | |   |         |   |     | | | |   | | | | | |
 | |   | |     | | | | |     | | |       |   |   | |     |   | |         |   | +---------|-|-----------------------|---|---|---|-------|-------|-|-----+ | |   |       +-----|-----|-|-|-|-+ | | | | | |
 | |   | |     | | | | |     | | |       |   |   | |     |   | |         |   | |         | |             |         |   | | |   | |     |     | | | | |   | |   |       | |   |     | | | | | | | | | | |
 +-+   | | +---|-----|-|-------|-|-------|-------|-----------|---------------------------------------------------------|-|-|-----|-+   |     | | | | |   | |   |       | |   |     | | | | | | | | | | |
       | | |   | | | | |     | | |       |   |   | |     |   | |         |   | |         | |             |         |   | | |   | | |   |     | | | | |   | |   |       | |   |     | | | | | | | | | | |
   +-------|---|-------------|-|---------|---+   | |     |   | |         |   | |         | |     +---------------------|-|-|-------|---------|-+ | | |   | | +-|-------+ |   |     | +---------|-|-----+
   |   | | |   | | | | |     | | |       |       | |     |   | |         |   | |         | |     |       |         |   | | |   | | |   |     |   | | |   | | | |         |   |     |   | | | | | | | |
 +-----|---------|-|-|-------|---|-----------------------|-------------+ |   | |         | |     |       |         |   | | |   | | |   |     |   | +-------|-|-|-------------------|---|-|-|-----+ | |
 | |   | | |   | | | | |     | | |       |       | |     |   | |       | |   | |         | |     |       |         |   | | |   | | |   |     |   |   |   | | | |         |   |     |   | | | | |   | |
 | +-----|-|-+ | | | | |     | | |       |   +---|-|---------|-|-------|-----|---------------------------|---------+   | | |   | | |   |     | +-|---|-----|-------+     |   |     | +-|-|-------+ | |
 |     | Y | | | | | | |     | | |       |   |   | |     |   | |       | |   | |         | |     |       |             | | |   | | |   |     | | |   |   | | | |   |     |   |     | | | | | | | | | |
 |     | | | | | | | | |     | | |       |   |   | |     | +-------------|-----|-----------|-----|-------|---------+   | | |   | +-|-------------|-------|-|-|-|---|---------------|---|---|-|-|---|-|-+
 |     | | | | | | | | |     | | |       |   |   | |     | | | |       | |   | |         | |     |       |         |   | | |   |   |   |     | | |   |   | | | |   |     |   |     | | | | | | | | | | |
 |     | | | | | | | | |     | | |       |   |   | |     | | | |       | |   +-|-----------------------------------|---|---|---|-------|-------|---------|-|---|-------------|-----|-+ | | | | | | | | |
 |     | | | | | | | | |     | | |       |   |   | |     | | | |       | |     |         | |     |       |         |   | | |   |   |   |     | | |   |   | | | |   |     |   |     |   | | | | | | | | |
 |     | | | | | | | | |     | +-|-------|---------|-----|-|-|-|-------|-----------------|-------|-----------------|-------|-----+ |   |     | | |   |   | | | |   |     |   |     | +---|---|-|-+ | | |
 |     | | | | | | | | |     |   |       |   |   | |     | | | |       | |     |         | |     |       |         |   | | |   | | |   |     | | |   |   | | | |   |     |   |     | | | | | | |   | | |
 |     | | | +-----|---|-------+ |     +-+   |   | |     | | | |     +---|-----|-------------------------------+   |   | | |   | | |   |     | +---+ |   | | +-|-------------|-----|---|-|---|-|---|-|-+
 |     | | |   | | | | |     | | |     |     |   | |     | | | |     | | |     |         | |     |       |     |   |   | | |   | | |   |     |   | | |   | |   |   |     |   |     | | | | | | |   | |
 |     | | | +---|-----|-------|-|-----------+   | |     | | | |     | | |     |         | |     |       +---------|-----|-----|---|---------------|-----|-|---|---|---------|-----|-----|-----|-------+
 |     | | Z | | | | | |     | | |     |         | |     | | | |     | | |     |         | |     |             |   |   | | |   | | |   |     |   | | |   | |   |   |     |   |     | | | | | | |   | | |
 |     | | | | | | | | |     | | |     |         | |     | | +---------|-|-----|---------|-|-----|-------+     |   |   | | |   | | |   |     |   | | |   +-|-------|-----|---------|-+ | | | | |   | | |
 |     | | | | | | | | |     | | |     |         | |     | |   |     | | |     |         | |     |       |     |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | | | | |   | | |
 |     | | | | | | | | |     | +-|-----------------|-----|-|--------M--+ |     |         | |     |       |     |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | | | | |   | | |
 |     | | | | | | | | |     |   |     |         | |     | |   |     |   |     |         | |     |       |     |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | | | | |   | | |
 |     | | | | | | | | |     |   +-----|---------|-----------------------|-----|-----------------|---------+   |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | | +-|-|-+ | | |
 |     | | | | | | | | |     |         |         | |     | |   |     |   |     |         | |     |       | |   |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | |   | | | | | |
 |     | | | | | | | | |   +---------------------|-------|---------------|-----|-------+ | |     |       | |   |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | |   | | | | | |
 |     | | | | | | | | |   | |         |         | |     | |   |     |   |     |       | | |     |       | |   |   |   | | |   | | |   |     |   | | |     |   |   |     |   |     |   | |   | | | | | |
 |     | | | | | | | | +-------+       |         | |     | |   |     |   |     |       | +---------------------|---|---|-------|-|-----|-----|---|-|-|---+ |   |   |     |   |     |   | |   | | | | | |
 |     | | | | | | | |     | | |       |         | |     | |   |     |   |     |       |   |     |       | |   |   |   | | |   | | |   |     |   | | |   | |   |   |     |   |     |   | |   | | | | | |
 |   +-----|---------+ +---|---|-----------------|-------|-----|---------|-----------------|-------------|-----|-----------+   | | +---|---------|-|-|---|-|---|---|---------------+   | |   | | | | | |
 |   | | | | | | | |   |   | | |       |         | |     | |   |     |   |     |       |   |     |       | |   |   |   | |     | |     |     |   | | |   | |   |   |     |   |         | |   | | | | | |
 |   | | | | | | | |   |   | | |       |         | |     | |   |     |   +-----------------+     |       +-|-------|-------------------+     |   | | |   | |   |   |     |   |         | |   | | | | | |
 |   | | | | | | | |   |   | | |       |         | |     | |   |     |         |       |         |         |   |   |   | |     | |           |   | | |   | |   |   |     |   |         | |   | | | | | |
 | +-|---------|-----------|---|-------------------|-----|-----|-----|-----------------|---------|-------+ |   |   |   | |     | |           |   | | |   | |   |   |     |   |         | |   | | | | | |
 | | | | | | | | | |   |   | | |       |         | |     | |   |     |         |       |         |       | |   |   |   | |     | |           |   | | |   | |   |   |     |   |         | |   | | | | | |
 | | | | | | | | | |   |   | | |       |         | |   +-|-----|-----|---------------------------|---------|-------------------|-------------------|-|-+ | |   |   |     |   |         | |   | | | | | |
 | | | | | | | | | |   |   | | |       |         | |   | | |   |     |         |       |         |       | |   |   |   | |     | |           |   | | | | | |   |   |     |   |         | |   | | | | | |
 +---|-|-------|-|-----+   | | |       |         | |   | | |   +---------------|-------------------------------|---|-----------|-------------|---|-----|-|-+   |   |     |   |         | |   | | | | | |
   | | | | | | | | |       | | |       |         | |   | | |         |         |       |         |       | |   |   |   | |     | |           |   | | | | |     |   |     |   |         | |   | | | | | |
   +-|-|-----|---|-----+   | | | +-----|---------------|-----------------------|-----------------|-------|---------|-------------------------|-------|---|-----|---------|---|---+     | |   | | | | | |
     | | | | | | | |   |   | | | |     |         | |   | | |         |         |       |         |       | |   |   |   | |     | |           |   | | | | |     |   |     |   |   |     | |   | | | | | |
     | | | | | | | |   |   | | +-|---------------|-----+ | |         |         |       |         |       | |   |   |   | |     | |           |   +-|---|-|-+   |   |     |   |   +---+ | |   | | | | | |
     | | | | | | | |   |   | |   |     |         | |     | |         |         |       |         |       | |   |   |   | |     | |           |     | | | | |   |   |     |   |       | | |   | | | | | |
   +---------|---|-|-------+ |   |     |         | |     | |         |         |       |         |       +-|---|---|---|-------|-------------|---+ | | +-|-+   |   |     |   |       | | |   | | | | | |
   | | | | | | | | |   |     |   |     |         | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |   |       | | |   | | | | | |
   | | | | | | | | |   |     |   |     |         | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |   |       | | |   | | | | | |
   | | | | | | | | |   |     |   |     |         | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |   |       | | |   | | | | | |
   | | | | | | | | |   |     |   |     | +-------|-|-------|---------|-----------------|---------|---------|---|---|-----|-------------------|-------|---------|---|-----|---+       | | |   | | | | | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |           | | |   | | | | | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |           | | |   | | | | | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |   |   | |     | |           |   | | |   |     |   |     |           | | |   | | | | | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |   +-+ | |     | |     +---+ |   | +-|-------------|-----------------|---|-----|-|-+ | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |     | | |     | |     |   | |   |   |   |     |   |     |           | | |   | | |   | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |     | | |     | |     |   | |   |   |   |     |   |     +-----------|-------|-+ |   | |
   | | | | | | | | |   |     |   |     | |       | |     | |         |         |       |         |         |   |     | | |     | |     |   | |   |   |   |     |   |                 | | |   |   |   B |
   | | | | | +-|-------|-----|---------|-+       | |     | |         |   +-----|-------|---------|---------|---|-----|-|-|-----|-----------------|-------------|---------+           | | |   |   |   | |
   | | | | |   | | |   |     |   |     |         | |     | |         |   |     |       |         |         |   |     | | |     | |     |   | |   |   |   |     |   |     |           | | |   |   |   | |
   | | | | |   | | |   |     |   |     | +-------+ |     | |         |   +-------------|-------------------|---+     | | |     | |     |   | |   |   |   |     |   |     |         +-|---|-+ |   |   | |
   | | | | |   | | |   |     |   |     | |         |     | |         |         |       |         |         |         | | |     | |     |   | |   |   |   |     |   |     |         | | | | | |   |   | |
   | | | +-|---+ +-----|-----|---|-----|-----------+     | |         |         |       |         |       +------H------|-----+ | |     |   | |   |   |   |     |   |     |         | | | | | |   |   | |
   | | |   |       |   |     |   |     | |               | |         |         |       |         |       | |         | | |   | | |     |   | |   |   |   |     |   |     |         | | | | | |   |   | |
 +-------------+   |   |     |   |     | |               | |         |         |       |         |       | |         | | |   | | |     |   | |   +---|---------|---+     |         | | | | | |   |   | |
 | | | |   |   |   |   |     |   |     | |               | |         |         |       |         |       | |         | | |   | | |     |   | |       A   |     |         |         | | | | | |   |   | |
 +-------+ +-------|-------+ |   |     | |               | |         |         |       |         +---------|---------|-|-----|-|-|---------|-------------------+ +-----+ |         | | | | | |   |   | |
   | | | |     |   |   |   | |   |     | |               | |         |         |       |                 | |         | | |   | | |     |   | |       |   |       |     | |         | | | | | |   |   | |
   | | | |     |   |   |   | |   | +-----------------------|-----------------------+   |                 +-+         | | |   | | |     |   | |       |   |       |     | |         | | | | | |   |   | |
   | | | |     |   |   |   | |   | |   | |               | |         |         |   |   |                             | | |   | | |     |   | |       |   |       |     | |         | | | | | |   |   | |
 +-----+ |     |   |   |   | |   | |   | |               | |         |         |   |   |                             | | |   | | |     |   | |   +-------|-----+ |     | |         | | | | | |   |   | |
 | | |   |     |   |   |   | |   | |   | |               | |         |         |   |   |                             | | |   | | |     |   | |   |   |   |     | |     | |         | | | | | |   |   | |
 | | +---|-----|-----------------|-|-----|-------------------------------------|-------+                             | +-----+ | |     |   | |   +---------------------------------|-|---|-+ |   |   | |
 | |     |     |   |   |   | |   | |   | |               | |         |         |   |                                 |   |     | |     |   | |       |   |     | |     | |         | | | |   |   |   | |
 | | +---------|-------|-----------|-----------------------+         +---------|-------------------------------------|---|-----|-------------|-------|---|-----|-|-------|-----------|-+ |   |   |   | |
 | | |   |     |   |   |   | |   | |   | |               |                     |   |                                 |   |     | |     |   | |       |   |     | |     | |         | |   |   |   |   | |
 | | +-+ | +---|-------|---|-|---|-----|-|-----------------------------------------|---------------------------------|---------|-------+   | |       |   +-----+ |     | |         | |   |   |   |   | |
 | |   | | |   |   |   |   | |   | |   | |               |                     |   |                                 |   |     | |         | |       |           |     | |         | |   |   |   |   | |
 | | +-+ | |   +---|-------|-|---|-|---|-+     +-----------+                   |   |                                 |   |     | |         | |       |           |     | |         | |   |   |   |   +-+
 | | |   | |       |   |   | |   | |   |       |         | |                   |   |                                 |   |     | |         | |       |           |     | |         | |   |   |   |
 +---|---|-+       |   |   | +---|-----|-------|---------|-------------------------|-------------------------------------------|-------------|-------|-----------------|-------------+   |   |   |
   | |   |         |   |   |     | |   |       |         | |                   |   |                                 |   |     | |         | |       |           |     | |         |     |   |   |
   | +---+         |   |   |     | |   |       |         | |                   |   +---------------------------------|---|-------|---+     | | +-------------------------|---------------+   |   |
   |               |   |   |     | |   |       |         | |                   |                                     |   |     | |   |     | | |     |           |     | |         |         |   |
   |               |   |   |     | |   |       |         | |                   |                                     |   |     | |   |     | | |     +-----------------+ +---------|-----------------+
   |               |   |   |     | |   |       |         | |                   |                                     |   |     | |   |     | | |                 |                 |         |   |   |
   |               |   |   |     | |   |       |         | |                   |                                     +---|-----|-|---|-----|-----------+         |                 |         |   |   |
   |               |   |   |     | |   |       |         | |                   |                                         |     | |   |     | | |       |         |                 |         |   |   |
   |               |   |   |     +-----|-------|-----------|-------------------|-----------------------------------------+     | +---|-----+ | |       |         |                 |         |   |   |
   |               |   |   |       |   |       |         | |                   |                                               |     |       | |       |         |                 |         |   |   |
   |               |   |   |       |   +-----------------|-|-------------------------------------------+       +---------------|-----+       | |       |         |                 |     +-------+   |
   |               |   |   |       |           |         | |                   |                       |       |               |             | |       |         |                 |     |   |       |
   |             +-+   +---+       +-----------+         | |                   |                       |       +---------------|---------------------------------|-----------------+ +---|---------+ |
   |             |                                       | |                   |                       |                       |             | |       |         |                   |   |   |     | |
 +-+             | +-------------------------------------|-+                   |                       +-------------------------------------|-------------------------------------------------------+
 |               | |                                     |                     |                                               |             | |       |         |                   |   |   |     |
 +-----------------|-------------------------------------|---------------------|-------------------------------------------------------------|-|-----------------|-----+             +---+   |   +-|-+
                 | |                                     |                     |                                               |             | |       |         |     |                     |   | | |
         +-------+ |                                     |                     +---------------------------------------+     +---------------+ |       | +-------------------------------+   |   +-----+
         |         |                                     |                                                             |     | |               |       | |       |     |                 |   |     | | |
         |         |                                     |                                       +---------------------|-------+               |       +-|-------|-------+               +---|-----|-+ |
         |         |                                     |                                       |                     |     |                 |         |       |     | |                   |     |   |
 +-------+         |                             +-------|-------------------------------------------------------------------------------------|---------|-------|-----|-+                   |     |   |
 |                 |                             |       |                                       |                     |     |                 |         |       |     |                     |     |   |
 +-------+         +-----------------------------+       +---------------------------------------|---------------------------|-----------------|---------+       |     +---------------------+   +-+ +-+
         |                                                                                       |                     |     |                 |                 |                               |   |
         +---------------------------------------------------------------------------------------+                     +-----+                 +-----------------+                               +---+`
  output = tube.walk(input)
  console.log(output)
  assert.equal(output[0], 'PBAZYFMHT')
  assert.equal(output[1], 16072)
}